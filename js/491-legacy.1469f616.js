"use strict";(self["webpackChunkpc_exam_student"]=self["webpackChunkpc_exam_student"]||[]).push([[491],{22491:function(e,r,a){a.r(r),a.d(r,{default:function(){return h}});var s=function(){var e=this,r=e._self._c;return r("div",{staticClass:"my-container"},[r("div",{staticClass:"my-layout"},[r("div",{staticClass:"menu-sidebar"},[r("el-menu",{staticClass:"menu-list",attrs:{"default-active":e.activeMenu},on:{select:e.handleMenuSelect}},[r("el-menu-item",{attrs:{index:"profile"}},[r("i",{staticClass:"el-icon-user"}),r("span",[e._v("个人资料")])]),r("el-menu-item",{attrs:{index:"security"}},[r("i",{staticClass:"el-icon-lock"}),r("span",[e._v("密码安全")])]),r("el-menu-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{index:"binding"}},[r("i",{staticClass:"el-icon-connection"}),r("span",[e._v("账号绑定")])]),r("el-menu-item",{attrs:{index:"certification"}},[r("i",{staticClass:"el-icon-document-checked"}),r("span",[e._v("实名认证")])]),r("el-menu-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{index:"certificate"}},[r("i",{staticClass:"el-icon-trophy"}),r("span",[e._v("我的证书")])]),r("el-menu-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{index:"message"}},[r("i",{staticClass:"el-icon-message"}),r("span",[e._v("站内信息")])]),r("el-menu-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{index:"points"}},[r("i",{staticClass:"el-icon-coin"}),r("span",[e._v("积分日志")])])],1)],1),r("div",{staticClass:"content-area"},["profile"===e.activeMenu?r("el-card",{staticClass:"content-card"},[r("div",{staticClass:"card-content"},[r("el-form",{ref:"profileForm",staticClass:"profile-form",attrs:{model:e.userInfo,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"用户编号"}},[r("el-input",{attrs:{disabled:""},model:{value:e.userInfo.userId,callback:function(r){e.$set(e.userInfo,"userId",r)},expression:"userInfo.userId"}})],1),r("el-form-item",{attrs:{label:"登录账号"}},[r("el-input",{attrs:{disabled:""},model:{value:e.userInfo.userName,callback:function(r){e.$set(e.userInfo,"userName",r)},expression:"userInfo.userName"}})],1),r("el-form-item",{attrs:{label:"姓名",prop:"nickName"}},[r("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:e.userInfo.nickName,callback:function(r){e.$set(e.userInfo,"nickName",r)},expression:"userInfo.nickName"}})],1),r("el-form-item",{attrs:{label:"手机号码"}},[r("el-input",{attrs:{disabled:""},model:{value:e.userInfo.phonenumber,callback:function(r){e.$set(e.userInfo,"phonenumber",r)},expression:"userInfo.phonenumber"}})],1),r("el-form-item",{attrs:{label:"所属部门"}},[r("el-input",{attrs:{disabled:""},model:{value:e.userInfo.dept.deptName,callback:function(r){e.$set(e.userInfo.dept,"deptName",r)},expression:"userInfo.dept.deptName"}})],1),r("el-form-item",{attrs:{label:"岗位"}},[r("el-input",{attrs:{disabled:""},model:{value:e.userInfo.postGroup,callback:function(r){e.$set(e.userInfo,"postGroup",r)},expression:"userInfo.postGroup"}})],1),r("el-form-item",{attrs:{label:"角色"}},[r("el-input",{attrs:{disabled:""},model:{value:e.userInfo.roleGroup,callback:function(r){e.$set(e.userInfo,"roleGroup",r)},expression:"userInfo.roleGroup"}})],1),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{attrs:{placeholder:"请输入邮箱"},model:{value:e.userInfo.email,callback:function(r){e.$set(e.userInfo,"email",r)},expression:"userInfo.email"}})],1),r("el-form-item",{attrs:{label:"头像"}},[r("div",{staticClass:"avatar-uploader"},[e.userInfo.avatar?r("img",{staticClass:"avatar",attrs:{src:e.userInfo.avatar}}):r("div",{staticClass:"avatar-placeholder"},[r("i",{staticClass:"el-icon-plus"})]),r("input",{staticClass:"avatar-input",attrs:{type:"file",accept:"image/jpeg,image/png"},on:{change:e.handleAvatarUpload}}),r("div",{staticClass:"upload-tip"},[e._v("请上传jpg或png格式图片")])])]),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("保存修改")])],1)],1)],1)]):e._e(),"security"===e.activeMenu?r("el-card",{staticClass:"content-card"},[r("div",{staticClass:"card-content"},[r("div",{staticClass:"card-header"},[r("h3",[e._v("修改密码")]),r("p",{staticClass:"tip"},[e._v("为了保证账号安全，请定期更换密码")])]),r("el-form",{ref:"passwordForm",staticClass:"password-form",attrs:{model:e.passwordForm,rules:e.passwordRules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"原始密码",prop:"oldPassword"}},[r("el-input",{attrs:{type:"password",placeholder:"请输入原始密码","show-password":""},model:{value:e.passwordForm.oldPassword,callback:function(r){e.$set(e.passwordForm,"oldPassword",r)},expression:"passwordForm.oldPassword"}})],1),r("el-form-item",{attrs:{label:"新的密码",prop:"newPassword"}},[r("el-input",{attrs:{type:"password",placeholder:"请输入新密码","show-password":""},model:{value:e.passwordForm.newPassword,callback:function(r){e.$set(e.passwordForm,"newPassword",r)},expression:"passwordForm.newPassword"}})],1),r("el-form-item",{attrs:{label:"确认密码",prop:"confirmPassword"}},[r("el-input",{attrs:{type:"password",placeholder:"请再次输入新密码","show-password":""},model:{value:e.passwordForm.confirmPassword,callback:function(r){e.$set(e.passwordForm,"confirmPassword",r)},expression:"passwordForm.confirmPassword"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.updatePassword}},[e._v("确认修改")])],1)],1)],1)]):e._e(),"certification"===e.activeMenu?r("el-card",{staticClass:"content-card"},[r("div",{staticClass:"card-content"},[r("div",{staticClass:"card-header"},[r("h3",[e._v("实名认证")]),r("p",{staticClass:"tip"},[e._v("请填写真实的身份信息，认证后不可修改")])]),r("el-form",{ref:"certificationForm",staticClass:"certification-form",attrs:{model:e.certificationForm,rules:e.certificationRules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"真实姓名",prop:"realName"}},[r("el-input",{attrs:{placeholder:"请输入真实姓名"},model:{value:e.certificationForm.realName,callback:function(r){e.$set(e.certificationForm,"realName",r)},expression:"certificationForm.realName"}}),r("div",{staticClass:"form-tip error-tip"},[e._v("真实姓名不能为空！")])],1),r("el-form-item",{attrs:{label:"人脸照片",prop:"faceImage"}},[r("div",{staticClass:"face-uploader"},[r("div",{staticClass:"face-preview",class:{"has-image":e.certificationForm.faceImage},on:{click:e.triggerUpload}},[e.certificationForm.faceImage?r("img",{staticClass:"preview-image",attrs:{src:e.certificationForm.faceImage}}):r("div",{staticClass:"upload-placeholder"},[r("i",{staticClass:"el-icon-plus"})])]),r("input",{ref:"faceInput",staticClass:"face-input",attrs:{type:"file",accept:"image/jpeg,image/png"},on:{change:e.handleFaceUpload}}),r("div",{staticClass:"upload-tips"},[r("p",[e._v("用于人脸登录，需要保证正脸位于图片中央")]),r("p",[e._v("图片质量会影响识别率")])])])]),r("el-form-item",{attrs:{label:"身份证号",prop:"idCard"}},[r("el-input",{attrs:{placeholder:"请输入身份证号"},model:{value:e.certificationForm.idCard,callback:function(r){e.$set(e.certificationForm,"idCard",r)},expression:"certificationForm.idCard"}}),r("div",{staticClass:"form-tip error-tip"},[e._v("身份证号码格式不正确！")])],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.submitCertification}},[e._v("提交认证")])],1)],1)],1)]):e._e()],1)])])},t=[],i=a(9217),o=a(7180),n=a(24634),l=(a(16280),a(44114),a(33110),a(79432),a(27495),a(90906),a(11392),a(47120));function c(){return(0,l.A)({url:"/system/user/profile",method:"get"})}function u(e){return(0,l.A)({url:"/system/user/profile",method:"put",data:e})}function m(e,r){return(0,l.A)({url:"/system/user/profile/updatePwd",method:"put",params:{oldPassword:e,newPassword:r}})}function d(e){return(0,l.A)({url:"/system/user/profile/avatar",method:"post",data:e,headers:{"Content-Type":"multipart/form-data"}})}var p=a(44973),f={name:"MyCenter",data:function(){var e=this,r=function(r,a,s){a!==e.passwordForm.newPassword?s(new Error("两次输入的密码不一致")):s()},a=function(e,r,a){var s=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;r?s.test(r)?a():a(new Error("身份证号格式不正确")):a(new Error("请输入身份证号"))};return{activeMenu:"profile",userInfo:{userId:"",userName:"",nickName:"",phonenumber:"",email:"",avatar:"",postGroup:"",roleGroup:"",dept:{deptName:""}},rules:{nickName:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},passwordForm:{oldPassword:"",newPassword:"",confirmPassword:""},passwordRules:{oldPassword:[{required:!0,message:"请输入原始密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:r,trigger:"blur"}]},certificationForm:{realName:"",faceImage:"",idCard:""},certificationRules:{realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],faceImage:[{required:!0,message:"请上传人脸照片",trigger:"change"}],idCard:[{required:!0,message:"请输入身份证号",trigger:"blur"},{validator:a,trigger:"blur"}]}}},methods:{handleMenuSelect:function(e){this.activeMenu=e},fetchUserProfile:function(){var e=this;return(0,n.A)((0,i.A)().m(function r(){var a,s,t,n,l,u;return(0,i.A)().w(function(r){while(1)switch(r.p=r.n){case 0:return r.p=0,r.n=1,c();case 1:a=r.v,200===a.code&&(s=a.data,t=s.user,n=s.postGroup,l=s.roleGroup,e.userInfo=(0,o.A)((0,o.A)({},t),{},{postGroup:n,roleGroup:l,dept:t.dept||{deptName:""}})),r.n=3;break;case 2:r.p=2,u=r.v,p.A.error("获取个人资料失败:",u),e.$message.error("获取个人资料失败");case 3:return r.a(2)}},r,null,[[0,2]])}))()},submitForm:function(){var e=this;return(0,n.A)((0,i.A)().m(function r(){var a,s,t;return(0,i.A)().w(function(r){while(1)switch(r.p=r.n){case 0:return r.p=0,r.n=1,u({nickName:e.userInfo.nickName,email:e.userInfo.email,sex:e.userInfo.sex,phonenumber:e.userInfo.phonenumber});case 1:a=r.v,200===a.code&&(e.$message.success("保存成功"),s=JSON.parse(localStorage.getItem("userInfo")||"{}"),localStorage.setItem("userInfo",JSON.stringify((0,o.A)((0,o.A)({},s),{},{nickName:e.userInfo.nickName,email:e.userInfo.email,sex:e.userInfo.sex,phonenumber:e.userInfo.phonenumber})))),r.n=3;break;case 2:r.p=2,t=r.v,p.A.error("保存个人资料失败:",t),e.$message.error("保存失败");case 3:return r.a(2)}},r,null,[[0,2]])}))()},handleAvatarUpload:function(e){var r=this;return(0,n.A)((0,i.A)().m(function a(){var s,t,n,l,c,u,m;return(0,i.A)().w(function(a){while(1)switch(a.p=a.n){case 0:if(s=e.target.files[0],s){a.n=1;break}return a.a(2);case 1:if(t=s.type.startsWith("image/"),t){a.n=2;break}return r.$message.error("请上传图片文件"),a.a(2);case 2:if(n=s.size/1024/1024<2,n){a.n=3;break}return r.$message.error("图片大小不能超过 2MB!"),a.a(2);case 3:return a.p=3,l=new FormData,l.append("avatarfile",s),a.n=4,d(l);case 4:c=a.v,200===c.code&&(r.userInfo.avatar=c.data.imgUrl,r.$message.success("头像上传成功"),u=JSON.parse(localStorage.getItem("userInfo")||"{}"),localStorage.setItem("userInfo",JSON.stringify((0,o.A)((0,o.A)({},u),{},{avatar:c.data.imgUrl})))),a.n=6;break;case 5:a.p=5,m=a.v,p.A.error("上传头像失败:",m),r.$message.error("上传头像失败");case 6:return a.a(2)}},a,null,[[3,5]])}))()},updatePassword:function(){var e=this;return(0,n.A)((0,i.A)().m(function r(){return(0,i.A)().w(function(r){while(1)switch(r.n){case 0:e.$refs.passwordForm.validate(function(){var r=(0,n.A)((0,i.A)().m(function r(a){var s,t,o;return(0,i.A)().w(function(r){while(1)switch(r.p=r.n){case 0:if(a){r.n=1;break}return r.a(2);case 1:return r.p=1,r.n=2,m(e.passwordForm.oldPassword,e.passwordForm.newPassword);case 2:s=r.v,200===s.code&&(e.$message.success("密码修改成功，请重新登录"),localStorage.removeItem("token"),localStorage.removeItem("userInfo"),e.$router.push("/login")),r.n=4;break;case 3:r.p=3,o=r.v,p.A.error("修改密码失败:",o),e.$message.error((null===(t=o.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.msg)||"修改密码失败");case 4:return r.a(2)}},r,null,[[1,3]])}));return function(e){return r.apply(this,arguments)}}());case 1:return r.a(2)}},r)}))()},triggerUpload:function(){this.$refs.faceInput.click()},handleFaceUpload:function(e){var r=this;return(0,n.A)((0,i.A)().m(function a(){var s,t,o,n;return(0,i.A)().w(function(a){while(1)switch(a.n){case 0:if(s=e.target.files[0],s){a.n=1;break}return a.a(2);case 1:if(t=s.type.startsWith("image/"),o=s.size/1024/1024<2,t){a.n=2;break}return r.$message.error("请上传图片文件!"),a.a(2);case 2:if(o){a.n=3;break}return r.$message.error("图片大小不能超过 2MB!"),a.a(2);case 3:try{n=new FormData,n.append("file",s)}catch(i){p.A.error("上传照片失败:",i),r.$message.error("上传照片失败")}case 4:return a.a(2)}},a)}))()},submitCertification:function(){this.$refs.certificationForm.validate(function(){var e=(0,n.A)((0,i.A)().m(function e(r){return(0,i.A)().w(function(e){while(1)switch(e.n){case 0:if(r){e.n=1;break}return e.a(2);case 1:case 2:return e.a(2)}},e)}));return function(r){return e.apply(this,arguments)}}())}},created:function(){this.fetchUserProfile()}},v=f,w=a(81656),g=(0,w.A)(v,s,t,!1,null,"045566d0",null),h=g.exports}}]);
//# sourceMappingURL=491-legacy.1469f616.js.map