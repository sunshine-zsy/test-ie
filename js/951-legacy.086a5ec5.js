"use strict";(self["webpackChunkpc_exam_student"]=self["webpackChunkpc_exam_student"]||[]).push([[951],{22951:function(t,e,n){n.r(e),n.d(e,{default:function(){return v}});n(74423),n(21699);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"exam-paper"},[e("div",{staticClass:"answer-card-sidebar"},[e("div",{staticClass:"answer-card"},[t._l(t.questionGroups,function(n,s){return e("div",{key:s,staticClass:"question-type-section"},[e("div",{staticClass:"type-header"},[t._v(" "+t._s(n.typeName)+"（总"+t._s(n.questions.length)+"题/共"+t._s(n.totalScore)+"分） ")]),e("div",{staticClass:"question-grid"},t._l(n.questions,function(n,s){return e("div",{key:n.id,staticClass:"question-number",class:{answered:n.answered,current:t.currentQuestion===n,flagged:n.isFlag},on:{click:function(e){return t.switchToQuestion(n)}}},[t._v(" "+t._s(s+1)+" ")])}),0)])}),e("div",{staticClass:"answer-stats"},[e("div",{staticClass:"stats-item"},[e("span",{staticClass:"stats-label"},[t._v("已答题数：")]),e("span",{staticClass:"stats-value"},[t._v(t._s(t.answeredCount))])]),e("div",{staticClass:"stats-item"},[e("span",{staticClass:"stats-label"},[t._v("未答题数：")]),e("span",{staticClass:"stats-value"},[t._v(t._s(t.questions.length-t.answeredCount))])]),e("div",{staticClass:"stats-item"},[e("span",{staticClass:"stats-label"},[t._v("标记题数：")]),e("span",{staticClass:"stats-value"},[t._v(t._s(t.flaggedCount))])])])],2)]),e("div",{staticClass:"main-content"},[e("div",{staticClass:"paper-content"},t._l(t.questionGroups,function(n,s){return e("div",{key:s,staticClass:"question-section"},[e("div",{staticClass:"section-title"},[t._v(" 第"+t._s(s+1)+"大题，"+t._s(n.typeName)+"（共"+t._s(n.questions.length)+"题，每题"+t._s(n.score)+"分，合计"+t._s(n.totalScore)+"分） ")]),t._l(n.questions,function(s,r){return e("div",{key:s.id,staticClass:"question-item",attrs:{id:"question-".concat(s.id)}},[e("div",{staticClass:"question-header"},[e("span",{staticClass:"question-index"},[t._v(t._s(r+1)+".")]),e("span",{staticClass:"question-type"},[t._v("【"+t._s(n.typeName)+"】")]),e("span",{staticClass:"question-score"},[t._v(t._s(s.score)+"分")]),e("span",{staticClass:"flag-btn",on:{click:function(e){return t.toggleFlag(s)}}},[e("i",{staticClass:"el-icon-warning-outline",class:{active:s.isFlag}}),t._v(" 疑难标记 ")])]),e("div",{staticClass:"question-content",domProps:{innerHTML:t._s(s.content)}}),[1,2].includes(s.type)?e("div",{staticClass:"options"},[1===s.type?e("el-radio-group",{on:{change:function(e){return t.handleAnswer(s)}},model:{value:s.answer,callback:function(e){t.$set(s,"answer",e)},expression:"question.answer"}},t._l(s.options,function(n){return e("el-radio",{key:n.code,staticClass:"option-item",attrs:{label:n.code,role:"radio","aria-checked":s.answer===n.code}},[e("div",{staticClass:"option-content",domProps:{innerHTML:t._s("".concat(n.content))}})])}),1):e("el-checkbox-group",{on:{change:function(e){return t.handleAnswer(s)}},model:{value:s.answer,callback:function(e){t.$set(s,"answer",e)},expression:"question.answer"}},t._l(s.options,function(n){return e("el-checkbox",{key:n.code,staticClass:"option-item",attrs:{label:n.code,role:"checkbox","aria-checked":s.answer.includes(n.code)}},[e("div",{staticClass:"option-content",domProps:{innerHTML:t._s("".concat(n.content))}})])}),1)],1):3===s.type?e("div",{staticClass:"options"},[e("el-radio-group",{on:{change:function(e){return t.handleAnswer(s)}},model:{value:s.answer,callback:function(e){t.$set(s,"answer",e)},expression:"question.answer"}},t._l(s.options,function(n){return e("el-radio",{key:n.id,staticClass:"option-item",attrs:{label:n.id,role:"radio","aria-checked":s.answer===n.id}},[t._v(" "+t._s(n.content)+" ")])}),1)],1):t._e()])})],2)}),0),e("div",{staticClass:"nav-sidebar"},[e("div",{staticClass:"nav-content"},[e("div",{staticClass:"time-info"},[e("div",{staticClass:"time-label"},[t._v("剩余时间")]),e("div",{staticClass:"time-value"},[t._v(t._s(t.formatTime(t.remainingTime)))])]),e("el-button",{staticClass:"submit-btn",attrs:{type:"warning"},on:{click:t.confirmSubmit}},[t._v("提交试卷")]),e("div",{staticClass:"nav-buttons"},[e("el-button",{attrs:{plain:""},on:{click:t.prevQuestion}},[e("i",{staticClass:"el-icon-arrow-left"}),t._v(" 上一题 ")]),e("el-button",{attrs:{type:"primary"},on:{click:t.nextQuestion}},[t._v(" 下一题 "),e("i",{staticClass:"el-icon-arrow-right"})])],1)],1)])])])},r=[],i=n(74953),a=n(9217),o=n(24634),c=(n(28706),n(2008),n(48980),n(48598),n(62062),n(44114),n(62010),n(18111),n(22489),n(7588),n(61701),n(18237),n(5506),n(26099),n(16034),n(38781),n(68156),n(23500),n(38429)),u=n(33443),l=n(44973),d={name:"ExamPaper",data:function(){return{examInfo:{title:"",duration:0,totalScore:0,passScore:0},questions:[],currentIndex:0,remainingTime:0,timer:null,submitDialogVisible:!1,questionTypes:{},questionGroups:[],answerCardVisible:!1,examId:"",paperId:"",studentId:""}},computed:{currentQuestion:function(){return this.questions[this.currentIndex]},answeredCount:function(){return this.questions.filter(function(t){return t.answered}).length},flaggedCount:function(){return this.questions.filter(function(t){return t.isFlag}).length}},created:function(){var t=this;return(0,o.A)((0,a.A)().m(function e(){return(0,a.A)().w(function(e){while(1)switch(e.n){case 0:return e.n=1,t.getQuestionTypes();case 1:return t.initExamInfo(),e.n=2,t.startExam();case 2:return e.a(2)}},e)}))()},beforeDestroy:function(){this.timer&&clearInterval(this.timer)},methods:{getQuestionTypes:function(){var t=this;return(0,o.A)((0,a.A)().m(function e(){var n,s;return(0,a.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,(0,u.PY)({pageNum:1,pageSize:10,dictType:"question_types"});case 1:n=e.v,200===n.code&&(t.questionTypes=(n.rows||[]).reduce(function(t,e){return t[e.dictValue]={name:e.dictLabel,score:20},t},{}),l.A.log("题型数据:",t.questionTypes)),e.n=3;break;case 2:e.p=2,s=e.v,l.A.error("获取题型列表失败:",s),t.$message.error("获取题型列表失败");case 3:return e.a(2)}},e,null,[[0,2]])}))()},initExamInfo:function(){var t=this.$route.query;this.examInfo={title:t.title||"",duration:parseInt(t.duration)||0,totalScore:parseInt(t.totalScore)||0,passScore:parseInt(t.passScore)||0},this.remainingTime=60*this.examInfo.duration,this.startTimer()},getExamPaper:function(){var t=this;return(0,o.A)((0,a.A)().m(function e(){var n,s;return(0,a.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,(0,c.QC)(t.$route.params.id);case 1:n=e.v,200===n.code&&(t.questions=(n.data.questionPapgerTopicList||[]).map(function(e){var n=e.questionsTopic||{},s=2===parseInt(n.topicType);return{id:n.id,type:parseInt(n.topicType),title:n.content,content:n.content,score:e.score||0,options:t.formatOptions(n.questionOptionsList),answer:s?[]:"",answered:!1,isFlag:!1,analysis:n.analysis,questionsTopic:n}}),t.groupQuestions()),e.n=3;break;case 2:e.p=2,s=e.v,l.A.error("获取试卷失败:",s),t.$message.error("获取试卷失败");case 3:return e.a(2)}},e,null,[[0,2]])}))()},startTimer:function(){var t=this;this.timer=setInterval(function(){t.remainingTime>0?t.remainingTime--:(clearInterval(t.timer),t.$message.warning("考试时间已到，系统将自动交卷"),t.confirmSubmit())},1e3)},formatTime:function(t){var e=Math.floor(t/3600),n=Math.floor(t%3600/60),s=t%60;return"".concat(e.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0"))},getQuestionType:function(t){var e;return(null===(e=this.questionTypes[t])||void 0===e?void 0:e.name)||"未知题型"},handleAnswer:function(t){t&&(t.answered=!0,this.updateAnswerCardStatus())},updateAnswerCardStatus:function(){this.questions.forEach(function(t){Array.isArray(t.answer)?t.answered=t.answer.length>0:t.answered=""!==t.answer})},switchQuestion:function(t){this.currentIndex=t},getFlatQuestions:function(){return this.questionGroups.reduce(function(t,e){return t.concat(e.questions)},[])},getCurrentFlatIndex:function(){var t=this,e=this.getFlatQuestions();return e.findIndex(function(e){return e.id===t.currentQuestion.id})},prevQuestion:function(){var t=this.getFlatQuestions(),e=this.getCurrentFlatIndex();if(e>0){var n=t[e-1];this.currentIndex=this.questions.findIndex(function(t){return t.id===n.id}),this.scrollToCurrentQuestion()}},nextQuestion:function(){var t=this.getFlatQuestions(),e=this.getCurrentFlatIndex();if(e<t.length-1){var n=t[e+1];this.currentIndex=this.questions.findIndex(function(t){return t.id===n.id}),this.scrollToCurrentQuestion()}},scrollToCurrentQuestion:function(){var t=this;this.$nextTick(function(){var e=t.questions[t.currentIndex];if(e){var n=document.querySelector("#question-".concat(e.id));n&&n.scrollIntoView({behavior:"smooth",block:"start"})}})},confirmSubmit:function(){var t=this;return(0,o.A)((0,a.A)().m(function e(){var n,s,r,o,c;return(0,a.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(e.p=0,n=t.questions.filter(function(t){return!t.answered}),s=n.length,!(s>0)){e.n=6;break}return r={},n.forEach(function(e){var n=t.getQuestionType(e.type);r[n]||(r[n]=[]),r[n].push(e)}),o="还有 ".concat(s," 道题未作答：\n\n"),Object.entries(r).forEach(function(t){var e=(0,i.A)(t,2),n=e[0],s=e[1];o+="".concat(n,"：").concat(s.length," 题\n")}),o+="\n确认提交试卷吗？",e.p=1,e.n=2,t.$confirm(o,"提交确认",{confirmButtonText:"确认提交",cancelButtonText:"继续答题",type:"warning",dangerouslyUseHTMLString:!0});case 2:return e.n=3,t.submitAnswers();case 3:e.n=5;break;case 4:e.p=4,e.v,n.length>0&&t.switchToQuestion(n[0]);case 5:e.n=10;break;case 6:return e.p=6,e.n=7,t.$confirm("已完成所有题目，确认提交试卷吗？","提交确认",{confirmButtonText:"确认提交",cancelButtonText:"再检查一下",type:"info"});case 7:return e.n=8,t.submitAnswers();case 8:e.n=10;break;case 9:e.p=9,e.v,l.A.debug("用户取消提交");case 10:e.n=12;break;case 11:e.p=11,c=e.v,l.A.error("提交试卷出错:",c),t.$message.error("提交试卷失败");case 12:return e.a(2)}},e,null,[[6,9],[1,4],[0,11]])}))()},submitAnswers:function(){var t=this;return(0,o.A)((0,a.A)().m(function e(){var n,s,r,i,o,u;return(0,a.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,n=t.questions.map(function(t){var e="";return Array.isArray(t.answer)?e=t.answer.join(","):""!==t.answer&&(e=t.answer),{topicId:t.id,answer:e}}),s={examId:t.examId,paperId:t.paperId,studentId:t.studentId,topicList:n},l.A.log("提交参数:",s),e.n=1,(0,c.PZ)(s);case 1:if(r=e.v,200!==r.code){e.n=3;break}return t.timer&&clearInterval(t.timer),e.n=2,(0,c.nQ)({fingerprint:localStorage.getItem("fingerprint")});case 2:t.$router.push({name:"ExamThanks",query:{examId:t.examId,title:t.examInfo.title,duration:t.examInfo.duration,questionCount:t.questions.length,score:null===(i=r.data)||void 0===i?void 0:i.score,type:void 0!==(null===(o=r.data)||void 0===o?void 0:o.score)?"immediate":"delay"}}),e.n=4;break;case 3:t.$message.error(r.msg||"交卷失败");case 4:e.n=6;break;case 5:e.p=5,u=e.v,l.A.error("交卷失败:",u),t.$message.error("交卷失败");case 6:return e.a(2)}},e,null,[[0,5]])}))()},formatOptions:function(t){return t&&Array.isArray(t)?t.map(function(t){return{id:t.id,code:t.id,content:t.content,isRight:1===t.isRight,imageUrl:t.imageUrl}}):[]},groupQuestions:function(){var t=this,e={};this.questions.forEach(function(n){var s=n.type;e[s]||(e[s]={typeName:t.getQuestionType(s),questions:[],score:n.score,totalScore:0}),e[s].questions.push(n),e[s].totalScore+=n.score}),this.questionGroups=Object.values(e)},toggleFlag:function(t){t.isFlag=!t.isFlag},showAnswerCard:function(){this.answerCardVisible=!0},switchToQuestion:function(t){var e=this.questions.findIndex(function(e){return e.id===t.id});-1!==e&&(this.currentIndex=e,this.answerCardVisible=!1,Array.isArray(t.answer)?t.answered=t.answer.length>0:t.answered=""!==t.answer,this.$nextTick(function(){var e=document.querySelector("#question-".concat(t.id));e&&e.scrollIntoView({behavior:"smooth",block:"start"})}))},startExam:function(){var t=this;return(0,o.A)((0,a.A)().m(function e(){var n,s,r;return(0,a.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(e.p=0,n={examId:t.$route.query.examId,studentId:t.$route.query.studentId,paperId:t.$route.params.id},n.examId&&n.studentId&&n.paperId){e.n=1;break}return t.$message.error("考试参数不完整"),t.$router.push("/exam"),e.a(2);case 1:return t.examId=n.examId,t.paperId=n.paperId,t.studentId=n.studentId,e.n=2,(0,c.S0)(n);case 2:if(s=e.v,200!==s.code){e.n=4;break}return l.A.log("开始考试成功"),e.n=3,t.getExamPaper();case 3:e.n=5;break;case 4:t.$message.error(s.msg||"开始考试失败"),t.$router.push("/exam");case 5:e.n=7;break;case 6:e.p=6,r=e.v,l.A.error("开始考试失败:",r),t.$router.push("/exam");case 7:return e.a(2)}},e,null,[[0,6]])}))()}},mounted:function(){l.A.log("路由参数:",this.$route.params),l.A.log("考试信息:",this.examInfo)}},p=d,m=n(81656),f=(0,m.A)(p,s,r,!1,null,"23754225",null),v=f.exports}}]);
//# sourceMappingURL=951-legacy.086a5ec5.js.map